language:
  name: erlang
  binary: escript
  repl: erl
  version: erl +V
devcontainer:
  build:
    packages:
      - erlang
    root:
      - ADD https://s3.amazonaws.com/rebar3/rebar3 /usr/local/bin/rebar3
      - RUN chmod +rx /usr/local/bin/rebar3
    files:
      rebar.config: |
        {plugins, [rebar3_format]}.

        {format,
        [{files, ["**/*.erl"]},
          {formatter, default_formatter},
          {options,
          #{% https://github.com/AdRoll/rebar3_format/blob/main/README.md#configuration
            break_indent => 2,
            inline_clause_bodies => true}}]}.
    user:
      - COPY --chown=vscode rebar.config ${HOME}/.config/rebar3/rebar.config
  selftest: |
    cat > /tmp/helloworld.erl <<EOF
    -module(helloworld).
    -export([main/1]).
    main(_) -> io:format("Hello World!\n").
    EOF
    rebar3 format --files /tmp/helloworld.erl
    escript /tmp/helloworld.erl
vscode:
  settings:
    "[erlang]":
      editor.tabSize: 2
      editor.defaultFormatter: szTheory.erlang-formatter
    erlangFormatter.formatter: rebar3_format
  extensions:
    - pgourlain.erlang
    - szTheory.erlang-formatter
  script: |
    -module(${TM_FILENAME/^(.*).erl$/$1/}).

    -export([main/1]).

    main(_) ->
      $1
